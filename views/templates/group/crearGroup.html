{% extends "layout.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename = 'css/groupStyle.css') }}">
{% endblock %}

{% block content %}
    {{ group.people }}


    <div class="container-group">
        <h2 class="group-heading">Crear Grupo</h2>
        <div class="group-form">
            <form method="POST" action="{{ url_for('group_blpr.group_add') }}">

                <div class="div-form">
                    <label for="name-group">Nombre del Grupo</label>
                    <input type="text" class="form-group" name="name-group" placeholder="Nombre de Grupo" value="{{ group.name }}"/>
                </div>

                <div class="div-form">
                    <label for="name-group">Descripción</label>
                    <input type="text" class="form-group" name="description-group" placeholder="Descripción" value="{{ group.description }}"/>
                </div>
                
                <div class="div-form">
                    <label for="new-user">Añadir participante</label>
                    <div class="div-form-people">
                        <input type="text" class="form-group form-group-persona" name="new-user" id="new-user" placeholder="Nombre de usuario" />
                        <button class="boton-añadir-form" onclick="addParticipant()" type="button">Añadir</button>
                    </div>
                </div>
                
                <div class="container-people">
                    <h3 class="title-people">Participantes</h3>
                    <ul id="participants-list" name="participants-list">
                        <!-- <li><span>Pedro</span> <button>X</button></li> -->

                        {% for person in group.people %}
                            <li>
                                <input type="hidden" name="participants[]" value="{{ person }}">
                                <span>{{ person }}</span> <button>X</button></li>
                        {% endfor %}
                        
                    </ul>
                </div>
                <div class="div-form-btn">
                    <button type="submit" class="btn btn-submit">Crear</button>
                </div>

            </form>
            
        </div>
        
    </div>

    <script>
        function addParticipant() {
            var newParticipant = document.getElementById("new-user").value;
            var participantsRaw = '{{ group.people | tojson }}';

            var participants = JSON.parse(participantsRaw);
            console.log(participants)

            // Realizar solicitud AJAX al servidor Flask
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/group/search", true);
            xhr.setRequestHeader("Content-Type", "application/json");
    
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    
                    var response = JSON.parse(xhr.responseText);
                    var participantsList = document.getElementById("participants-list");
                    participant = response.participant;

                    var listItem = document.createElement("li");
                                
                    listItem.innerHTML = '<input type="hidden" name="participants[]" value="' + participant +'">' 
                        +'<span>' + participant + '</span> <button>X</button>';
                    participantsList.appendChild(listItem);
                }
            };
    
            var data = JSON.stringify({newParticipant: newParticipant, participants: participants });
            xhr.send(data);
        }
    </script>
    

{% endblock %}